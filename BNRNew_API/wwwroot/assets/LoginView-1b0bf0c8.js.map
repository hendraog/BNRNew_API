{"version":3,"file":"LoginView-1b0bf0c8.js","sources":["../../src/views/LoginView.vue"],"sourcesContent":["<script setup>\r\n    import { ref, onMounted, inject, getCurrentInstance } from 'vue'\r\n    import { useRoute,useRouter  } from 'vue-router'\r\n    import CryptoJS from 'crypto-js';\r\n\r\n    const httpClient = inject('httpClient');\r\n    const auth = inject('auth');\r\n    const app = getCurrentInstance().appContext;\r\n\r\n    const emit = defineEmits(['showLoading','loggedIn'])\r\n\r\n\r\n    const route = useRoute()\r\n    const router = useRouter()\r\n\r\n    const username = ref(\"\");\r\n    const password = ref(\"\");\r\n    const remember = ref(\"\");\r\n    \r\n\r\n    \r\n    const doLogin = async () => {\r\n      if (password.value.length > 0) {\r\n        const hash = CryptoJS.SHA256(password.value);\r\n        var passHash = hash.toString(CryptoJS.enc.Hex);\r\n\r\n          emit('showLoading', true);\r\n          var response = await httpClient('post', '/user/login',{\r\n             \"userid\": username.value,\r\n             \"password\":passHash\r\n           });\r\n          emit('showLoading', false);\r\n\r\n          if(response.status == 200){\r\n            auth.setToken(response.data.accessToken);\r\n\r\n            if (auth.getToken() != null){\r\n                if(remember.value){\r\n                    auth.setLocalUser(username.value, password.value);\r\n                }else{\r\n                    auth.removeLocalUser();\r\n                }\r\n\r\n                emit('loggedIn')\r\n                emit('showLoading', false);\r\n\r\n                if(route.params.nextUrl != null){\r\n                    router.push(this.$route.params.nextUrl)\r\n                } else {\r\n                  router.push({path:'/home'})\r\n                }\r\n            }\r\n          }else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n          }\r\n          console.log(response);\r\n        }\r\n    }\r\n\r\n    const onEnter =() => {\r\n        if(username.value && password.value ){\r\n            doLogin();\r\n        }\r\n    };\r\n\r\n    onMounted(async () => {\r\n        //check user token data is it still valid\r\n        var user = auth.getTokenData();\r\n        if (user){\r\n            emit('showLoading', true);\r\n            var response = await httpClient('get', '/user/profile');\r\n            emit('showLoading', false);\r\n            if(response.status == 200){\r\n                router.push('Home')\r\n            }\r\n        }\r\n\r\n        var rememberUser = auth.getLocalUser();\r\n        if(rememberUser){\r\n            remember.value  = true;\r\n            username.value = rememberUser.user;\r\n            password.value = rememberUser.pass;\r\n        }else{\r\n            remember.value  = false;\r\n        }\r\n    });\r\n</script>\r\n\r\n<template>\r\n    <div class=\"flex items-center justify-center w-screen  h-screen\">\r\n\r\n        <div class=\" shadow w-96 rounded-xl bg-gray-700\">\r\n            <div class=\"flex flex-col px-6 py-6 lg:px-8\">\r\n                <h3 class=\"text-xl font-medium text-gray-900 text-white pb-5 self-center\">Masuk Ke Aplikasi</h3>\r\n\r\n                <form class=\"space-y-6\" action=\"#\">\r\n                    <div>\r\n                        <label for=\"email\" class=\"block mb-2 text-sm font-medium text-white\">User Id</label>\r\n                        <input type=\"text\" name=\"userid\" id=\"userid\" v-model=\"username\" @keyup.enter=\"onEnter\"\r\n                            class=\"w-full text-inputText hover:bg-inputHover border-5 focus:bg-inputHover disabled:bg-inputBgDisable disabled:text-inputText text-sm rounded-md block p-2\"\r\n                            placeholder=\"User Id\" required>\r\n                    </div>\r\n                    <div>\r\n                        <label for=\"password\" class=\"block mb-2 text-sm font-medium text-white\">Password</label>\r\n                        <input type=\"password\" name=\"password\" id=\"password\" placeholder=\"password\" v-model=\"password\" @keyup.enter=\"onEnter\"\r\n                            class=\"w-full text-inputPassword hover:bg-inputHover border-5 focus:bg-inputHover disabled:bg-inputBgDisable disabled:text-inputText text-sm rounded-md block p-2\"\r\n                            required>\r\n                    </div>\r\n\r\n                    <div class=\"flex justify-between pt-10\">\r\n                        <div class=\"flex items-start\">\r\n                            <div class=\"flex items-center h-5\">\r\n                                <input id=\"remember\" type=\"checkbox\" v-model=\"remember\"\r\n                                    class=\"w-4 h-4 border rounded bg-gray-600 border-gray-500 focus:ring-blue-600 ring-offset-gray-800 focus:ring-offset-gray-800\"\r\n                                    required>\r\n                            </div>\r\n                            <label for=\"remember\" class=\"ml-2 text-sm font-medium text-gray-300\">Remember\r\n                                me</label>\r\n                        </div>\r\n                </div>\r\n\r\n                <button type=\"button\" @click=\"doLogin\"\r\n                    class=\"w-full bg-blue-700 hover:bg-blue-500 text-white focus:ring-blue-800 focus:ring-4 focus:outline-none font-medium rounded-lg text-sm px-5 py-2.5 text-center\"> Login to your account</button>\r\n\r\n            </form>\r\n        </div>\r\n    </div>\r\n\r\n\r\n</div></template>"],"names":["httpClient","inject","auth","app","getCurrentInstance","emit","__emit","route","useRoute","router","useRouter","username","ref","password","remember","doLogin","passHash","CryptoJS","response","onEnter","onMounted","user","rememberUser"],"mappings":"s7BAKI,MAAMA,EAAaC,EAAO,YAAY,EAChCC,EAAOD,EAAO,MAAM,EACpBE,EAAMC,EAAoB,EAAC,WAE3BC,EAAOC,EAGPC,EAAQC,EAAU,EAClBC,EAASC,EAAW,EAEpBC,EAAWC,EAAI,EAAE,EACjBC,EAAWD,EAAI,EAAE,EACjBE,EAAWF,EAAI,EAAE,EAIjBG,EAAU,SAAY,CAC1B,GAAIF,EAAS,MAAM,OAAS,EAAG,CAE7B,IAAIG,EADSC,EAAS,OAAOJ,EAAS,KAAK,EACvB,SAASI,EAAS,IAAI,GAAG,EAE3CZ,EAAK,cAAe,EAAI,EACxB,IAAIa,EAAW,MAAMlB,EAAW,OAAQ,cAAc,CACnD,OAAUW,EAAS,MACnB,SAAWK,CACxB,CAAY,EACFX,EAAK,cAAe,EAAK,EAEtBa,EAAS,QAAU,KACpBhB,EAAK,SAASgB,EAAS,KAAK,WAAW,EAEnChB,EAAK,SAAU,GAAI,OAChBY,EAAS,MACRZ,EAAK,aAAaS,EAAS,MAAOE,EAAS,KAAK,EAEhDX,EAAK,gBAAe,EAGxBG,EAAK,UAAU,EACfA,EAAK,cAAe,EAAK,EAEtBE,EAAM,OAAO,SAAW,KACvBE,EAAO,KAAK,KAAK,OAAO,OAAO,OAAO,EAExCA,EAAO,KAAK,CAAC,KAAK,OAAO,CAAC,IAIhCN,EAAI,OAAO,iBAAiB,aAAae,EAAS,OAAO,EAE3D,QAAQ,IAAIA,CAAQ,CACrB,CACJ,EAEKC,EAAS,IAAM,CACdR,EAAS,OAASE,EAAS,OAC1BE,GAEZ,EAEI,OAAAK,EAAU,SAAY,CAElB,IAAIC,EAAOnB,EAAK,eAChB,GAAImB,EAAK,CACLhB,EAAK,cAAe,EAAI,EACxB,IAAIa,EAAW,MAAMlB,EAAW,MAAO,eAAe,EACtDK,EAAK,cAAe,EAAK,EACtBa,EAAS,QAAU,KAClBT,EAAO,KAAK,MAAM,CAEzB,CAED,IAAIa,EAAepB,EAAK,eACrBoB,GACCR,EAAS,MAAS,GAClBH,EAAS,MAAQW,EAAa,KAC9BT,EAAS,MAAQS,EAAa,MAE9BR,EAAS,MAAS,EAE9B,CAAK"}