{"version":3,"file":"MasterUserView-024ce115.js","sources":["../../src/views/MasterUserView.vue"],"sourcesContent":["<script setup>\r\n    import { ref, onMounted, inject, getCurrentInstance, computed } from 'vue'\r\n    import { useRoute,useRouter  } from 'vue-router'\r\n    import CryptoJS from 'crypto-js';\r\n\r\n    const httpClient = inject('httpClient');\r\n    const auth = inject('auth');\r\n    const app = getCurrentInstance().appContext;\r\n\r\n    const route = useRoute()\r\n    const router = useRouter()\r\n    const emit = defineEmits(['showLoading','showAlert','showConfirmationDlg'])\r\n\r\n    const inputDlg = ref(null);\r\n    const dataTable = ref(null);\r\n    const roleSelection = ref([]);\r\n    const activeSelection = ref([\"Active\",\"InActive\"]);\r\n\r\n\r\n    const fields = [\r\n        { key: \"id\", label: \"Id\", sortable: true, highlight: true },\r\n        { key: \"userName\", label: \"User Name\", sortable: true, highlight: true },\r\n        { key: \"role\", label: \"Role\", sortable: true },\r\n        { key: \"activeStatus\", label: \"Active\", sortable: true},\r\n        { key: \"createdAt\", label: \"CREATED AT\", sortable: true, datetime: true },\r\n        { key: \"updatedAt\", label: \"UPDATED AT\", sortable: true, datetime: true }\r\n    ];\r\n\r\n    const loadItems = async (page, sortBy, sortDesc, limit, search) => {\r\n        search = search;        \r\n        emit(\"showLoading\", true);\r\n        var response = await httpClient(\"get\", `/user?page=${page}&pageSize=${limit}&filter=${search}`);\r\n        emit(\"showLoading\", false);\r\n        \r\n        console.log(response);\r\n        if (response.status == 200) {\r\n            response.data.forEach(e => {\r\n                e.activeStatus = e.active? \"Active\":\"InActive\"\r\n            });\r\n            return response.data;\r\n        } else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n        }\r\n    }\r\n\r\n    \r\n    const loadRole = async () => {\r\n        emit(\"showLoading\", true);\r\n        var response = await httpClient(\"get\", `/master/role`);\r\n        emit(\"showLoading\", false);\r\n        \r\n        console.log(response);\r\n        if (response.status == 200) {\r\n            var s = response.data.map(e=> {\r\n            return {\r\n                key: e,\r\n                label: e\r\n            }});\r\n            roleSelection.value =  s;\r\n        }\r\n        else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n        }\r\n    }\r\n\r\n\r\n    onMounted(() => {\r\n        loadRole();\r\n    })\r\n\r\n    const onCreateNew = () => {\r\n        inputDlg.value.showDlg({\r\n            userName: null,\r\n            role: \"\",\r\n            password: \"\",\r\n            passwordRaw: \"\",\r\n            activeStatus: \"Active\"\r\n        });\r\n    }\r\n\r\n    const onEdit = async (data) => {\r\n        emit(\"showLoading\", true);\r\n        var response = await httpClient(\"get\", `/user/` + data.id);\r\n        emit(\"showLoading\", false);\r\n        \r\n        console.log(response);\r\n        if (response.status == 200) {\r\n            response.data.password = \"\";\r\n            response.data.passwordRaw = \"\";\r\n            response.data.activeStatus = response.data.active? \"Active\":\"InActive\"\r\n\r\n            inputDlg.value.showDlg(response.data);\r\n        }\r\n        else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n        }\r\n    }\r\n\r\n    const onDelete =async (data) => {\r\n        emit(\"showLoading\", true);\r\n        var response = await httpClient(\"delete\", `/user/` + data.id);\r\n        emit(\"showLoading\", false);\r\n        \r\n        console.log(response);\r\n        if (response.status == 200) {\r\n            app.config.globalProperties.showErrorDlg(\"Data Deleted\");\r\n            dataTable.value.loadData();\r\n        } else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n        }\r\n    }\r\n    \r\n    const submit =async (data) => {\r\n        emit(\"showLoading\", true);\r\n\r\n        if(data.activeStatus == \"Active\"){            \r\n            data.active = true;\r\n        }else{\r\n            data.active = false;\r\n        }\r\n\r\n        if(data.passwordRaw && data.passwordRaw.trim()){\r\n            const hash = CryptoJS.SHA256(data.passwordRaw);\r\n            data.password = hash.toString(CryptoJS.enc.Hex);\r\n        }\r\n\r\n        var response = await httpClient(data.id?\"put\":\"post\", '/user',data);\r\n        emit(\"showLoading\", false);\r\n        \r\n        console.log(response);\r\n        if (response.status == 200) {\r\n            inputDlg.value.hide();\r\n            dataTable.value.loadData();\r\n            return data;\r\n        }\r\n        else {\r\n            app.config.globalProperties.showErrorDlg(response.message);\r\n        }\r\n    }\r\n\r\n    const haveManagePermission = computed({\r\n        get(){\r\n            return auth.checkPermission(\"MasterGolonganManage\");\r\n        } \r\n    })\r\n\r\n</script>\r\n\r\n<template>\r\n    <MenuTitleLabel label=\"Master User\"></MenuTitleLabel>\r\n    <DataTable  ref=\"dataTable\"\r\n                v-bind:fields=\"fields\"\r\n                :loadDataFunction=\"loadItems\"\r\n                :enableDelete=\"haveManagePermission\"\r\n                :enableCreate=\"haveManagePermission\"\r\n                :enableUpdate=\"haveManagePermission\"\r\n                @onCreateNew=\"onCreateNew\" \r\n                @onEdit=\"onEdit\" \r\n                @onDelete=\"onDelete\">\r\n    </DataTable>\r\n\r\n    <InputModalDialog  ref=\"inputDlg\" title=\"Data User\"  v-model:data=\"currentData\" \r\n        @onSubmitClick=\"submit\" \r\n        :enableSubmit=\"haveManagePermission\" >\r\n\r\n        <template #dlgContent=\"dlgContent\">\r\n            <MyInputText label=\"User Name\" v-model:value=\"dlgContent.currentDialogData.userName\" />\r\n            <MyInputText label=\"Password\" v-model:value=\"dlgContent.currentDialogData.passwordRaw\" />\r\n            <DropDown label=\"Role\"  :data=\"roleSelection\" valueByKey\r\n                v-model:selectedData=\"dlgContent.currentDialogData.role\"></DropDown>\r\n            <DropDown label=\"Active\"  :data=\"activeSelection\"\r\n                v-model:selectedData=\"dlgContent.currentDialogData.activeStatus\"></DropDown>\r\n        </template> \r\n    </InputModalDialog>    \r\n    \r\n</template>"],"names":["httpClient","inject","auth","app","getCurrentInstance","useRoute","useRouter","emit","__emit","inputDlg","ref","dataTable","roleSelection","activeSelection","fields","loadItems","page","sortBy","sortDesc","limit","search","response","e","loadRole","s","onMounted","onCreateNew","onEdit","data","onDelete","submit","hash","CryptoJS","haveManagePermission","computed"],"mappings":"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"}