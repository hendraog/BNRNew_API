import{_ as W,i as j,g as X,u as Y,a as C,r as _,o as aa,j as P,k as p,c as L,l as t,m as S,F as ea,n as U,f as B,b as o,p as la,q as ta,t as na}from"./index-71bc4530.js";import{S as ra}from"./index-20f92749.js";const oa={class:"flex flex-row w-full"},ua={class:"flex-1 flex flex-col"},sa=o("div",{class:"p-2"},[o("div",{class:"bg-white h-full",style:{width:"1px"}})],-1),ia={class:"flex-1 flex flex-col"},ca=o("div",{class:"p-2"},[o("div",{style:{width:"1px"},class:"bg-white h-full"})],-1),ga={class:"flex-1 flex flex-col"},da={class:"flex flex-row"},Da=o("div",{class:"grow"},null,-1),va={class:"flex flex-row"},pa=o("div",{class:"w-4"},null,-1),_a=o("div",{class:"w-4"},null,-1),ha={class:"flex flex-row"},ba=o("div",{class:"w-4"},null,-1),ma=o("div",{class:"w-4"},null,-1),ka={class:"flex-row"},fa=o("div",{class:"grow"},null,-1),wa=o("div",{class:"grow"},null,-1),ya={class:"flex w-full justify-center items-center pr-3"},xa=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mr-2 w-5 h-5"},[o("path",{"fill-rule":"evenodd",d:"M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.097 1.126.153A2.212 2.212 0 0 1 18 8.653v4.097A2.25 2.25 0 0 1 15.75 15h-.241l.305 1.984A1.75 1.75 0 0 1 14.084 19H5.915a1.75 1.75 0 0 1-1.73-2.016L4.492 15H4.25A2.25 2.25 0 0 1 2 12.75V8.653c0-1.082.775-2.034 1.874-2.198.374-.056.75-.107 1.127-.153L5 6.25v-3.5Zm8.5 3.397a41.533 41.533 0 0 0-7 0V2.75a.25.25 0 0 1 .25-.25h6.5a.25.25 0 0 1 .25.25v3.397ZM6.608 12.5a.25.25 0 0 0-.247.212l-.693 4.5a.25.25 0 0 0 .247.288h8.17a.25.25 0 0 0 .246-.288l-.692-4.5a.25.25 0 0 0-.247-.212H6.608Z","clip-rule":"evenodd"})],-1),Ua=o("div",{class:"grow"},null,-1),Ta=o("label",{class:"text-white"},"Jumlah Print Ticket ",-1),ja=o("div",{style:{width:"10px"}},null,-1),Pa={class:"text-white"},La={__name:"Ticket",emits:["showLoading","showAlert","showConfirmationDlg"],setup(Sa,{emit:M}){const d=j("httpClient"),m=j("auth"),v=X().appContext;Y(),C();const i=M,r=_(null),y=_(null),N=[{key:"id",label:"Id",sortable:!0,highlight:!0},{key:"ticket_no",label:"No",sortable:!0,highlight:!0},{key:"tanggal_berlaku",label:"Tanggal Berlaku",sortable:!0,datetime:!0},{key:"golongan_name",label:"Golongan",sortable:!0},{key:"harga",label:"Harga",sortable:!0,number:!0},{key:"biaya_tuslah",label:"Biaya Tuslah",sortable:!0,number:!0},{key:"total_harga",label:"Total",sortable:!0,number:!0},{key:"plat_no",label:"Plat",sortable:!0},{key:"createdAt",label:"Created At",sortable:!0,datetime:!0},{key:"createdByName",label:"Created By",sortable:!0}],A={tally_no:{type:"string",required:!0,message:"Silahkan input no tally"},panjang_kenderaan:{type:"number",required:!0,min:1,max:999,message:"Silahkan input Panjang kenderaan antara 1-999"},tinggi_kenderaan:{type:"number",required:!0,min:1,max:999,message:"Silahkan input Tinggi kenderaan antara 1-999"},lebar_kenderaan:{type:"number",required:!0,min:1,max:999,message:"Silahkan input Lebar kenderaan antara 1-999"},panjang_ori_kenderaan:{type:"number",required:!0,min:1,max:999,message:"Silahkan input Panjang Ori kenderaan antara 1-999"},plat_no:{type:"string",required:!0,pattern:"^[a-zA-Z]{1,2} [0-9]{1,4} [a-zA-Z]{1,3}$",message:"Silahkan input no Plat yg benar"}},k=_([]),h=_([]),f=_(!0),w=_(!1);aa(()=>{O(),V()});const E=P({get(){return m.checkPermission("TicketDelete")}}),I=P({get(){return m.checkPermission("TicketCreate")}}),O=async()=>{i("showLoading",!0);var l=await d("get","/golongan?page=1&pageSize=1000");if(i("showLoading",!1),console.log(l),l.status==200){var u=l.data.map(n=>({key:n.id,label:n.golongan,min_length:n.min_length,max_length:n.max_length,harga:n.harga}));k.value=u}else v.config.globalProperties.showErrorDlg(l.message)},V=async()=>{i("showLoading",!0);var l=await d("get","/master/lokasi-pelabuhan");if(i("showLoading",!1),console.log(l),l.status==200){var u=l.data.map(n=>({key:n,label:n}));h.value=u}else v.config.globalProperties.showErrorDlg(l.message)},q=async(l,u,n,c,s)=>{s=s,i("showLoading",!0);var D=await d("get",`/ticket?page=${l}&pageSize=${c}&filter=${s}`);if(i("showLoading",!1),console.log(D),D.status==200)return D.data;v.config.globalProperties.showErrorDlg(D.message)},H=()=>{r.value.showDlg({tanggal_masuk:U.utc(),tanggal_berlaku:U().utc().add(1,"days").toDate(),golongan:null,nama_pengurus:"dasdas",lokasi_asal:h.value[0].key,lokasi_tujuan:h.value[1].key,harga:0,biaya_tuslah:0,jumlah_orang:1,min_length:1,max_length:1,createdAt:null,updatedAt:null}),f.value=!0,w.value=!1},K=async l=>{i("showLoading",!0);var u=await d("get","/ticket/"+l.id);i("showLoading",!1),console.log(u),u.status==200?r.value.showDlg(u.data):v.config.globalProperties.showErrorDlg(u.message),T(u.data),w.value=!0},Z=l=>{console.log(l)},z=async l=>{new ra(A).validate(l).then(async()=>{i("showLoading",!0);var n=await d(l.id?"put":"post","/ticket",l);if(i("showLoading",!1),console.log(n),n.status==200){var c=n.data;return r.value.currentDialogData.ticket_no=c.ticket_no,r.value.currentDialogData.id=c.id,y.value.loadData(),w.value=!0,l}else v.config.globalProperties.showErrorDlg(n.message)}).catch(({errors:n,fields:c})=>{var s="";n.forEach(D=>{s+="* "+(D.message+"<br>")}),v.config.globalProperties.showErrorDlg(s)})},$=async()=>{i("showLoading",!0);var l=await d("get","/ticket/print-data/"+r.value.currentDialogData.id,{});if(console.log(l),l.status==200){var u=await d("post",l.data.print_url,l.data.print_data);if(u.status==200){var n=await d("put","/ticket/do-print",{id:r.value.currentDialogData.id}),c=n.data;r.value.currentDialogData.printer_count=c.printer_count,y.value.loadData(),T(r.value.currentDialogData)}else v.config.globalProperties.showErrorDlg("Silahkan cek PC Kasir apakah PrinterUtils telah di jalakan pada alamat berikut ini "+l.data.print_url);i("showLoading",!1)}else i("showLoading",!1),v.config.globalProperties.showErrorDlg(l.message)},T=l=>{m.checkPermission("TicketUpdate")||m.checkPermission("TicketUpdateBeforePrint")&&l.printer_count==0?f.value=!0:f.value=!1},F=l=>{r.value.currentDialogData.tanggal_berlaku=U(l).add(1,"days").toDate()},J=l=>{b()},b=()=>{r.value.currentDialogData.total_harga=r.value.currentDialogData.biaya_tuslah+r.value.currentDialogData.harga},G=l=>{var u=k.value.find(n=>n.key==l);u!=null?(r.value.currentDialogData.harga=u.harga,(r.value.currentDialogData.panjang_kenderaan>u.max_length||r.value.currentDialogData.panjang_kenderaan<u.min_length)&&(r.value.currentDialogData.panjang_kenderaan=null),b()):(r.value.currentDialogData.harga=0,b())},R=async l=>{i("showLoading",!0);var u=await d("get","/golongan-plat/searchplat?platno="+l.value,{id:r.value.currentDialogData.id});if(i("showLoading",!1),u.status==200){r.value.currentDialogData.golongan=u.data.golonganid;var n=k.value.find(c=>c.key==u.data.golonganid);n!=null&&(r.value.currentDialogData.harga=n.harga,(r.value.currentDialogData.panjang_kenderaan>n.max_length||r.value.currentDialogData.panjang_kenderaan<n.min_length)&&(r.value.currentDialogData.panjang_kenderaan=null),b())}else r.value.currentDialogData.golongan=null,r.value.currentDialogData.harga=0,b()};return(l,u)=>{const n=p("MenuTitleLabel"),c=p("DataTable"),s=p("MyInputText"),D=p("MyInputDate"),x=p("DropDown"),g=p("MyInputNumber"),Q=p("InputModalDialog");return B(),L(ea,null,[t(n,{label:"Transaksi Ticket"}),t(c,{ref_key:"dataTable",ref:y,fields:N,loadDataFunction:q,enableCreate:I.value,enableDelete:E.value,onOnCreateNew:H,onOnEdit:K,onOnDelete:Z},null,8,["enableCreate","enableDelete"]),t(Q,{w:"80%",ref_key:"inputDlg",ref:r,title:"Data Ticket",enableSubmit:f.value,onOnSubmitClick:z},{dlgContent:S(a=>[o("div",oa,[o("div",ua,[t(s,{label:"Ticket No",disabled:"",value:a.currentDialogData.ticket_no,"onUpdate:value":e=>a.currentDialogData.ticket_no=e},null,8,["value","onUpdate:value"]),t(s,{label:"No Tally",maxlength:"40",disabled:a.currentDialogData.id,value:a.currentDialogData.tally_no,"onUpdate:value":e=>a.currentDialogData.tally_no=e},null,8,["disabled","value","onUpdate:value"]),t(D,{label:"Tanggal Masuk",onOnChange:F,disabled:a.currentDialogData.id,value:a.currentDialogData.tanggal_masuk,"onUpdate:value":e=>a.currentDialogData.tanggal_masuk=e},null,8,["disabled","value","onUpdate:value"]),t(D,{label:"Tanggal Berlaku",disabled:"",value:a.currentDialogData.tanggal_berlaku,"onUpdate:value":e=>a.currentDialogData.tanggal_berlaku=e},null,8,["disabled","value","onUpdate:value"]),t(x,{label:"Lokasi Asal",data:h.value,valueByKey:"",disabled:a.currentDialogData.id,selectedData:a.currentDialogData.lokasi_asal,"onUpdate:selectedData":e=>a.currentDialogData.lokasi_asal=e},null,8,["data","disabled","selectedData","onUpdate:selectedData"]),t(x,{label:"Lokasi Tujuan",data:h.value,valueByKey:"",disabled:a.currentDialogData.id,selectedData:a.currentDialogData.lokasi_tujuan,"onUpdate:selectedData":e=>a.currentDialogData.lokasi_tujuan=e},null,8,["data","disabled","selectedData","onUpdate:selectedData"])]),sa,o("div",ia,[t(s,{label:"Nama Pengurus",maxlength:"100",value:a.currentDialogData.nama_pengurus,"onUpdate:value":e=>a.currentDialogData.nama_pengurus=e},null,8,["value","onUpdate:value"]),t(s,{label:"Tuslah",maxlength:"100",value:a.currentDialogData.tuslah,"onUpdate:value":e=>a.currentDialogData.tuslah=e},null,8,["value","onUpdate:value"]),t(s,{label:"Jenis Muatan",maxlength:"200",value:a.currentDialogData.jenis_muatan,"onUpdate:value":e=>a.currentDialogData.jenis_muatan=e},null,8,["value","onUpdate:value"]),t(s,{label:"Nama Supir",maxlength:"100",value:a.currentDialogData.nama_supir,"onUpdate:value":e=>a.currentDialogData.nama_supir=e},null,8,["value","onUpdate:value"]),t(s,{label:"Alamat Supir",maxlength:"200",value:a.currentDialogData.alamat_supir,"onUpdate:value":e=>a.currentDialogData.alamat_supir=e},null,8,["value","onUpdate:value"]),t(s,{label:"Asal Supir",maxlength:"500",value:a.currentDialogData.asal_supir,"onUpdate:value":e=>a.currentDialogData.asal_supir=e},null,8,["value","onUpdate:value"]),t(s,{label:"Tujuan Supir",maxlength:"500",value:a.currentDialogData.tujuan_supir,"onUpdate:value":e=>a.currentDialogData.tujuan_supir=e},null,8,["value","onUpdate:value"])]),ca,o("div",ga,[o("div",da,[t(s,{label:"Plat No",w:"140px",maxlength:"11",onOnChange:R,inputAdditionalClass:"uppercase",value:a.currentDialogData.plat_no,"onUpdate:value":e=>a.currentDialogData.plat_no=e},null,8,["value","onUpdate:value"]),Da,t(x,{label:"Golongan",data:k.value,valueByKey:"",onOnChange:G,selectedData:a.currentDialogData.golongan,"onUpdate:selectedData":e=>a.currentDialogData.golongan=e},null,8,["data","selectedData","onUpdate:selectedData"])]),o("div",va,[t(g,{ref:"panjang",label:"Panjang",class:"shrink",nextElement:"Tinggi",value:a.currentDialogData.panjang_kenderaan,"onUpdate:value":e=>a.currentDialogData.panjang_kenderaan=e},null,8,["value","onUpdate:value"]),pa,t(g,{ref:"Tinggi",label:"Tinggi",class:"shrink",value:a.currentDialogData.tinggi_kenderaan,"onUpdate:value":e=>a.currentDialogData.tinggi_kenderaan=e},null,8,["value","onUpdate:value"]),_a,t(g,{ref:"Lebar",label:"Lebar",class:"flex-grow",value:a.currentDialogData.lebar_kenderaan,"onUpdate:value":e=>a.currentDialogData.lebar_kenderaan=e},null,8,["value","onUpdate:value"])]),o("div",ha,[t(g,{label:"PanjangOri",value:a.currentDialogData.panjang_ori_kenderaan,"onUpdate:value":e=>a.currentDialogData.panjang_ori_kenderaan=e},null,8,["value","onUpdate:value"]),ba,t(g,{label:"Berat",value:a.currentDialogData.berat,"onUpdate:value":e=>a.currentDialogData.berat=e},null,8,["value","onUpdate:value"]),ma,t(g,{label:"Volume",value:a.currentDialogData.volume,"onUpdate:value":e=>a.currentDialogData.volume=e},null,8,["value","onUpdate:value"])]),o("div",ka,[t(g,{label:"Jumlah Orang",w_value:"50px",value:a.currentDialogData.jumlah_orang,"onUpdate:value":e=>a.currentDialogData.jumlah_orang=e},null,8,["value","onUpdate:value"]),fa,t(g,{label:"Harga",disabled:"",value:a.currentDialogData.harga,"onUpdate:value":e=>a.currentDialogData.harga=e},null,8,["value","onUpdate:value"]),wa,t(g,{label:"Biaya Tuslah",onOnChange:J,value:a.currentDialogData.biaya_tuslah,"onUpdate:value":e=>a.currentDialogData.biaya_tuslah=e},null,8,["value","onUpdate:value"])]),t(g,{label:"Total Harga",disabled:"",value:a.currentDialogData.total_harga,"onUpdate:value":e=>a.currentDialogData.total_harga=e},null,8,["value","onUpdate:value"])])]),t(s,{label:"Keterangan",maxlength:"1000",value:a.currentDialogData.keterangan,"onUpdate:value":e=>a.currentDialogData.keterangan=e},null,8,["value","onUpdate:value"])]),additionalButton:S(a=>[o("div",ya,[w.value?(B(),L("button",{key:0,onClick:$,style:{height:"3em"},class:"inline-flex items-center justify-center text-white m-2 bg-yellow-600 hover:bg-yellow-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-3 py-2.5 text-center"},[xa,la(" Print ")])):ta("v-if",!0),Ua,Ta,ja,o("label",Pa,na(a.currentDialogData.printer_count),1)])]),_:1},8,["enableSubmit"])],64)}}},Na=W(La,[["__file","D:/sourcecode/my_api/bnr_app_ui/src/views/Ticket.vue"]]);export{Na as default};
//# sourceMappingURL=Ticket-c2edc16a.js.map
